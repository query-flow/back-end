# ========================================
# ğŸ” JWT Authentication
# ========================================
# Sistema de autenticaÃ§Ã£o baseado em tokens JWT
# Gere uma chave ÃšNICA para cada ambiente!
#
# Comando para gerar:
#   python3 -c "import secrets; print(secrets.token_hex(32))"
JWT_SECRET_KEY=<gere-com-comando-acima>

# ========================================
# ğŸ”‘ Criptografia de Dados
# ========================================
# Chave para criptografar senhas de conexÃ£o das orgs
# Gere com:
#   python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
FERNET_KEY=<gere-com-comando-acima>

# ========================================
# ğŸ—„ï¸ Banco de Dados (ConfiguraÃ§Ã£o da Plataforma)
# ========================================
# URL de conexÃ£o ao banco 'empresas' que armazena:
# - UsuÃ¡rios Platform Admin (role='admin')
# - OrganizaÃ§Ãµes
# - Documentos e schemas
# - Membros de cada org
#
# IMPORTANTE: O banco serÃ¡ criado AUTOMATICAMENTE quando vocÃª inicia a app!
# Ele lÃª os modelos Python em app/models/database_models.py e cria as tabelas.
#
# Formatos suportados:
#   MySQL:     mysql+pymysql://user:password@host:port/database?charset=utf8mb4
#   PostgreSQL: postgresql://user:password@host:port/database
#
# Para desenvolvimento local com Docker MySQL:
#   mysql+pymysql://root:insper@127.0.0.1:3306/empresas?charset=utf8mb4
CONFIG_DB_URL=mysql+pymysql://<user>:<password>@<host>:<port>/empresas?charset=utf8mb4

# ========================================
# ğŸ¤– LLM (Azure OpenAI)
# ========================================
# ConfiguraÃ§Ã£o para o Pipeline LLM
# Funcionalidades:
# - Gerar SQL a partir de perguntas em linguagem natural
# - Gerar insights e anÃ¡lises BI
# - Gerar grÃ¡ficos automÃ¡ticos
#
# Obtenha esses valores no Azure Portal > OpenAI
AZURE_OPENAI_ENDPOINT=https://<seu-recurso>.openai.azure.com
AZURE_OPENAI_API_KEY=<sua-api-key-aqui>
AZURE_OPENAI_DEPLOYMENT=gpt-4o_TechSolucoes
AZURE_OPENAI_API_VERSION=2025-01-01-preview

# Desabilitar LLM para testes sem custos
# 0 = usar LLM (padrÃ£o)
# 1 = desabilitar (apenas para desenvolvimento)
DISABLE_AZURE_LLM=0

# ========================================
# ğŸ“‹ SETUP INICIAL - Passo a Passo
# ========================================
#
# 1ï¸âƒ£ Gerar chaves (execute os comandos acima):
#    python3 -c "import secrets; print(secrets.token_hex(32))"
#    python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
#
# 2ï¸âƒ£ Criar arquivo .env nesta pasta:
#    cp .env.example .env
#    nano .env  (editar com valores reais)
#
# 3ï¸âƒ£ Criar banco de dados MySQL:
#    mysql -u root -p -e "CREATE DATABASE empresas CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci"
#
# 4ï¸âƒ£ Instalar dependÃªncias Python:
#    python3 -m venv .venv
#    source .venv/bin/activate  (ou .venv\Scripts\activate no Windows)
#    pip install -r requirements.txt
#
# 5ï¸âƒ£ Iniciar a aplicaÃ§Ã£o (o banco Ã© criado automaticamente!):
#    uvicorn app.main:app --reload
#
#    âœ… Ao iniciar, a funÃ§Ã£o init_db() em app/main.py vai:
#       - Conectar ao banco de dados
#       - Ler os modelos Python (app/models/database_models.py)
#       - CRIAR AUTOMATICAMENTE todas as tabelas
#
# 6ï¸âƒ£ (OPCIONAL) Se vocÃª estiver migrando de uma versÃ£o antiga:
#    python run_migration.py
#    (Adiciona colunas JWT aos bancos existentes)
#
# 7ï¸âƒ£ Criar primeiro usuÃ¡rio Platform Admin:
#    python create_platform_admin.py
#
# 8ï¸âƒ£ Testar a pipeline LLM:
#    python test_llm_pipeline_complete.py

# ========================================
# ğŸŒ AMBIENTES
# ========================================
#
# DESENVOLVIMENTO:
#   - Use banco local (127.0.0.1)
#   - JWT_SECRET_KEY pode ser conhecida
#   - DISABLE_AZURE_LLM=0 ou 1 (conforme queira testar)
#   - Sem HTTPS (http://localhost:8000)
#
# STAGING:
#   - Use banco staging dedicado
#   - JWT_SECRET_KEY DIFERENTE do desenvolvimento
#   - DISABLE_AZURE_LLM=0 (testar com LLM real)
#   - Teste a pipeline completa
#
# PRODUÃ‡ÃƒO:
#   - Use banco de produÃ§Ã£o com backups!
#   - JWT_SECRET_KEY SUPER SECRETO (nunca no Git!)
#   - DISABLE_AZURE_LLM=0 (usar LLM real)
#   - Com HTTPS (https://seu-dominio.com)
#   - Monitoramento e alertas ativados
#
# IMPORTANTE: Cada ambiente deve ter um .env DIFERENTE!

# ========================================
# ğŸ“š ARQUITETURA DO BANCO DE DADOS
# ========================================
#
# Tabelas criadas automaticamente (veja app/models/database_models.py):
#
# users
#   â”œâ”€â”€ id (UUID)
#   â”œâ”€â”€ email (login Platform Admin)
#   â”œâ”€â”€ role: 'admin' (Platform Admin) | 'user' (regular)
#   â”œâ”€â”€ password_hash (bcrypt, para JWT)
#   â”œâ”€â”€ status: 'active' | 'inactive' | 'invited'
#   â”œâ”€â”€ invite_token (para convites)
#   â””â”€â”€ ... (mais campos)
#
# orgs
#   â”œâ”€â”€ id (UUID)
#   â”œâ”€â”€ name (nome da organizaÃ§Ã£o)
#   â””â”€â”€ ... (informaÃ§Ãµes da org)
#
# org_members (link users â†” orgs)
#   â”œâ”€â”€ user_id â†’ users.id
#   â”œâ”€â”€ org_id â†’ orgs.id
#   â””â”€â”€ role_in_org: 'org_admin' | 'member'
#
# org_db_connections (credenciais da org)
#   â”œâ”€â”€ org_id â†’ orgs.id
#   â”œâ”€â”€ driver, host, port, database_name
#   â””â”€â”€ password_enc (criptografado com FERNET_KEY)
#
# org_allowed_schemas (schemas que org pode acessar)
#   â”œâ”€â”€ org_id â†’ orgs.id
#   â””â”€â”€ schema_name
#
# biz_documents (documentaÃ§Ã£o das orgs)
#   â”œâ”€â”€ id
#   â”œâ”€â”€ org_id â†’ orgs.id
#   â”œâ”€â”€ title
#   â””â”€â”€ metadata_json
#
# query_audit (log de consultas)
#   â”œâ”€â”€ id
#   â”œâ”€â”€ org_id
#   â”œâ”€â”€ sql_text
#   â””â”€â”€ duration_ms

# ========================================
# ğŸ” SISTEMA DE AUTENTICAÃ‡ÃƒO
# ========================================
#
# 2 TIPOS DE USUÃRIOS:
#
# 1. Platform Admin (users.role = 'admin')
#    - Faz login em /auth/admin-login
#    - Token JWT vÃ¡lido por 24h
#    - Acesso a /admin/* endpoints
#    - Pode criar/gerenciar organizaÃ§Ãµes
#    - Pode criar/gerenciar usuÃ¡rios
#
# 2. Org Member/Admin (org_members.role_in_org = 'org_admin'/'member')
#    - Faz login em /auth/login
#    - Token JWT vÃ¡lido por 24h
#    - Acesso apenas Ã  sua organizaÃ§Ã£o
#    - Pode convidar novos membros (se org_admin)
#    - Pode fazer consultas NLâ†’SQL (se org_admin ou member)

# ========================================
# ğŸš€ COMO A APP FUNCIONA
# ========================================
#
# Quando vocÃª executa: uvicorn app.main:app --reload
#
# 1ï¸âƒ£ FastAPI inicia em http://localhost:8000
#
# 2ï¸âƒ£ FunÃ§Ã£o startup() Ã© chamada (app/main.py:20-40)
#    - init_db() conecta ao banco
#    - LÃª Base.metadata (todos os modelos)
#    - Executa CREATE TABLE IF NOT EXISTS para cada modelo
#    - âœ… BANCO CRIADO AUTOMATICAMENTE!
#
# 3ï¸âƒ£ AplicaÃ§Ã£o fica pronta para requisiÃ§Ãµes
#    GET  /              â†’ Health check
#    GET  /docs          â†’ Swagger UI (testes)
#    POST /auth/admin-login â†’ Login Platform Admin
#    POST /auth/login       â†’ Login Org Member
#    POST /admin/orgs       â†’ Criar organizaÃ§Ã£o
#    POST /admin/orgs/{id}/members â†’ Convidar membro
#    POST /perguntar_org    â†’ Fazer pergunta NLâ†’SQL
#
# 4ï¸âƒ£ Primeiras requisiÃ§Ãµes
#    - Crie um Platform Admin: python create_platform_admin.py
#    - FaÃ§a login: POST /auth/admin-login
#    - Crie uma org: POST /admin/orgs
#    - Teste a LLM: python test_llm_pipeline_complete.py

# ========================================
# âš ï¸ TROUBLESHOOTING
# ========================================
#
# "ConnectionRefusedError" ao iniciar:
#   â†’ MySQL nÃ£o estÃ¡ rodando
#   â†’ Verifique: docker ps | grep mysql
#   â†’ Inicie: docker-compose up -d (se tiver docker-compose.yml)
#
# "No module named 'mysql.connector'" ou similar:
#   â†’ pip install -r requirements.txt
#   â†’ pip install pymysql (driver MySQL especÃ­fico)
#
# "Token invÃ¡lido ou expirado":
#   â†’ JWT_SECRET_KEY foi alterada
#   â†’ Todos os tokens antigos ficam invÃ¡lidos
#   â†’ FaÃ§a login novamente
#
# "Sem acesso a esta organizaÃ§Ã£o":
#   â†’ User nÃ£o estÃ¡ linkado Ã  org (org_members)
#   â†’ Administrador deve adicionar membro: POST /admin/orgs/{id}/members
#
# LLM retorna erro:
#   â†’ Verificar AZURE_OPENAI_ENDPOINT, API_KEY, DEPLOYMENT
#   â†’ Testar conexÃ£o: curl https://seu-endpoint/health
#   â†’ Se quiser desabilitar: DISABLE_AZURE_LLM=1

# ========================================
# ğŸ“š REFERÃŠNCIAS
# ========================================
#
# DocumentaÃ§Ã£o do projeto:
#   - README.md         â†’ Overview
#   - DEPLOY.md         â†’ Como fazer deploy em produÃ§Ã£o
#   - GUIA_JWT_AUTH.md  â†’ ExplicaÃ§Ã£o do sistema JWT
#   - ANALISE_LLM.md    â†’ Arquitetura da Pipeline LLM
#
# Links Ãºteis:
#   - FastAPI: https://fastapi.tiangolo.com/
#   - SQLAlchemy: https://docs.sqlalchemy.org/
#   - JWT: https://jwt.io/
#   - Azure OpenAI: https://learn.microsoft.com/pt-br/azure/ai-services/openai/
